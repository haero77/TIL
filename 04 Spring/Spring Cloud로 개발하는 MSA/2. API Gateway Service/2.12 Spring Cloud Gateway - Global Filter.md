
# Global Filter

## ì™œ í•„ìš”í•œê°€?

```yml
spring:  
  application:  
    name: apigateway-service  
  cloud:  
    gateway:  
      routes:  
        - id: first-service  
          uri: http://localhost:8081/  
          predicates:  
            - Path=/first-service/**  
          filters:  
            - CustomFilter  
        - id: second-service  
          uri: http://localhost:8082/  
          predicates:  
            - Path=/second-service/**  
          filters:  
            - CustomFilter
```

- ì´ì „ì— ê°œë°œí•œ ì»¤ìŠ¤í…€ í•„í„°ì˜ ê²½ìš° ê° ë¼ìš°íŒ… ì •ë³´ë§ˆë‹¤ í•„ìš”í•œ í•„í„°ê°€ ìˆì„ ê²½ìš°ì— ë‹¤ ì§€ì •í•´ì•¼í–ˆìŒ.
- ê³µí†µì ì¸ í•„í„°ê°€ ìˆë‹¤ë©´ ë§¤ë²ˆ ì§€ì •í•  í•„ìš”ê°€ ì—†ë‹¤ ğŸ‘‰ ê¸€ë¡œë²Œ í•„í„°

## êµ¬í˜„

### GlobalFilter.java

![](attachments/Pasted%20image%2020240107174151.png)

```java
@Component  
@Slf4j  
public class GlobalFilter extends AbstractGatewayFilterFactory<GlobalFilter.Config> {  
  
    public GlobalFilter() {  
       super(Config.class);  
    }  
  
    @Override  
    public GatewayFilter apply(Config config) {  
       return (exchange, chain) -> {  
          ServerHttpRequest request = exchange.getRequest();  
          ServerHttpResponse response = exchange.getResponse();  
  
          log.info("Global Filter baseMessage: {}", config.getBaseMessage());  
  
          if (config.isPreLogger()) {  
             log.info("Global Filter Start: request id -> {}", request.getId());  
          }  
  
          return chain.filter(exchange).then(Mono.fromRunnable(() -> {  
             if (config.isPostLogger()) {  
                log.info("Global Filter End: response status code -> {}", response.getStatusCode());  
             }  
          }));  
       };  
    }  
  
    @Getter  
    @Setter    
    public static class Config {  
  
       private String baseMessage;  
       private boolean preLogger;  
       private boolean postLogger;  
  
    }  
  
}
```

### application.yml

![](attachments/Pasted%20image%2020240107174538.png)
```yml
spring:  
  application:  
    name: apigateway-service  
  cloud:  
    gateway:  
      default-filters:  
        - name: GlobalFilter  
          args:  
            baseMessage: Spring Cloud Gateway Global Filter  
            preLogger: true  
            postLogger: true  
      routes:  
        - id: first-service  
          uri: http://localhost:8081/  
          predicates:  
            - Path=/first-service/**  
          filters:  
#            - AddRequestHeader=first-request, first-request-header2 # (key, value)  
#            - AddResponseHeader=first-response, first-response-header2  
            - CustomFilter  
        - id: second-service  
          uri: http://localhost:8082/  
          predicates:  
            - Path=/second-service/**  
          filters:  
#            - AddRequestHeader=second-request, second-request-header2  
#            - AddResponseHeader=second-response, second-response-header2  
            - CustomFilter
```

### ë¬¸ì œ: applicatoin.yml ì— ì •ì˜ëœ ë°ì´í„°ëŠ” ë‚´ì¥ ë°ì´í„°

- ë³€ê²½ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ê°’ì„ ë°”ê¾¼ ë‹¤ìŒ, ë‹¤ì‹œ ë¹Œë“œí•˜ê³ , ë‹¤ì‹œ íŒ¨í‚¤ì§• í•˜ê³  ë‹¤ì‹œ ë°°í¬ë¥¼ í•´ì•¼í•¨.

```yml
      default-filters:  
        - name: GlobalFilter  
          args:  
            baseMessage: Spring Cloud Gateway Global Filter  
            preLogger: true  
            postLogger: true  
```

- ì´ëŸ° ì •ë³´ë“¤ì„ íƒ€ì´í•‘í•´ì„œ ì“°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì™¸ë¶€ì—ì„œ ê°€ì ¸ì™€ì„œ ì“°ë©´ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ ìì²´ëŠ” ê°±ì‹ ë˜ì§€ ì•Šê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. (8ì¥ì—ì„œ ë°°ìš¸ ê²ƒì„)


## í…ŒìŠ¤íŠ¸

![](attachments/Pasted%20image%2020240107174625.png)
![](attachments/Pasted%20image%2020240107175919.png) 

- ê¸€ë¡œë²Œ í•„í„°ëŠ” í•„í„° ìµœì „ì„ , ìµœí›„ë°©ì— ì‹¤í–‰ëœë‹¤.
